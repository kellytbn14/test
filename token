app.UseOpenIdConnectAuthentication(new OpenIdConnectAuthenticationOptions
{
    ClientId = AuthProperties.ClientId,
    ClientSecret = AuthProperties.ClientSecret,
    Authority = AuthProperties.BaseUrl,
    RedirectUri = AuthProperties.RedirectUri,
    ResponseType = OpenIdConnectResponseType.CodeIdToken,
    Scope = "openid profile email",
    Notifications = new OpenIdConnectAuthenticationNotifications
    {
        SecurityTokenValidated = context =>
        {
            var idToken = context.ProtocolMessage.IdToken;
            var accessToken = context.ProtocolMessage.AccessToken;

            if (!string.IsNullOrEmpty(idToken))
            {
                var claimsIdentity = context.AuthenticationTicket.Identity;
                claimsIdentity.AddClaim(new System.Security.Claims.Claim("id_token", idToken));
            }

            if (!string.IsNullOrEmpty(accessToken))
            {
                var claimsIdentity = context.AuthenticationTicket.Identity;
                claimsIdentity.AddClaim(new System.Security.Claims.Claim("access_token", accessToken));
            }

            return Task.CompletedTask;
        }
    }
});



using System;
using System.IdentityModel.Tokens.Jwt;
using System.Linq;
using System.Web;

public partial class Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string idToken = HttpContext.Current.GetOwinContext().Authentication.User.FindFirst("id_token")?.Value;

        if (!string.IsNullOrEmpty(idToken))
        {
            var handler = new JwtSecurityTokenHandler();
            var token = handler.ReadJwtToken(idToken);

            // Obtener el "sub" (ID del usuario)
            var userId = token.Claims.FirstOrDefault(c => c.Type == "sub")?.Value;

            // Obtener el "locale" (Idioma del usuario)
            var userLocale = token.Claims.FirstOrDefault(c => c.Type == "locale")?.Value;

            // Mostrar los valores en la p√°gina
            lblUserId.Text = userId ?? "ID de usuario no encontrado";
            lblUserLocale.Text = userLocale ?? "Idioma no encontrado";
        }
        else
        {
            lblUserId.Text = "ID Token no disponible.";
            lblUserLocale.Text = "Idioma no disponible.";
        }
    }
}
